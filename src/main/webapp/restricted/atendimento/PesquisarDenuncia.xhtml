<ui:composition template="/WEB-INF/template/LayoutPadrao.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
 	xmlns:h="http://xmlns.jcp.org/jsf/html"
 	xmlns:f="http://xmlns.jcp.org/jsf/core"
 	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:o="http://omnifaces.org/ui">

    <ui:define name="titulo">Formulário de Denúncia</ui:define>
    
    <ui:define name="corpo">    	
    
    	<h2>Registrar Denúncia</h2>
    	
    	<h:form id="frmDenuncia"
    	target="_blank">
    	
    		<p:growl id="growl" showDetail="false"> 
    			<p:autoUpdate />
    		</p:growl>


			<p:toolbar id="toolbar" style="margin-top: 20px">
				<p:toolbarGroup>
					<p:commandButton icon="pi pi-user-plus" value="Registrar Denúncia" title="Nova"		
						action="/restricted/agenda/CadastroDenuncia.xhtml" />
				</p:toolbarGroup>
			</p:toolbar>  

			<!--  Lista de denuncias nao terminadas -->
			<p:dataTable id="listaDataTable"  value="#{registrarDenunciaBean.denuncias}" var="denuncia"
				allowUnsorting="true" sortMode="single"
	    		style="margin-top: 20px" emptyMessage="Nenhuma denuncia encontrada." rows="10" 
	    		paginator="true" paginatorAlwaysVisible="true" paginatorPosition="bottom" 
	    		rowsPerPageTemplate="10,15,20"
	    		selectionMode="single" selection="#{registrarDenunciaBean.denuncia}" rowKey="#{denuncia.codigo}">
	    		
	    		<p:ajax event="rowSelect" update="listaDataTable" />			
				<p:ajax event="rowUnselect" update="listaDataTable" />

		    		
		    	<p:column headerText="Data" style="width: 15px; text-align: center"
		    		sortBy="#{denuncia.dataEmissao}">		    		
		    		<h:outputText value="#{denuncia.dataEmissao}">
	    				<f:convertDateTime pattern="dd/MM/yyyy" />
	    			</h:outputText>	    		
	    		</p:column>	    				    		


				<p:column headerText="Código" style="width: 10px; text-align: center">	    			
	    			<h:outputText value="#{denuncia.codigo}"/>
	    		</p:column>
	    		
	    		<p:column headerText="Nome do Responsavel" style="width: 80px; text-align: center">	    			
	    			<h:outputText value="#{denuncia.familia.pessoaReferencia.nome}" />
	    		</p:column>
				
				<p:column headerText="Relato" style="width: 80px; text-align: center">	    			
	    			<h:outputText value="#{denuncia.relato}" />
	    		</p:column> 
	    		
	    		<p:column headerText="RD Status" style="width: 30px; text-align: center">		
	    			<h:outputText value="#{denuncia.statusRD}" />
	    		</p:column>
	    		
	    		<p:column headerText="Operações" style="width: 65px; text-align: center" >

					<p:button outcome="/restricted/agenda/CadastroDenuncia.xhtml" icon="pi pi-pencil" title="Editar Denuncia"
						disabled="#{registrarDenunciaBean.denuncia.codigo eq null}">
						<f:param name="denuncia" value="#{denuncia.codigo}" />
					</p:button>
					
					
					<p:commandButton icon="pi pi-plus" title="Adicionar Pessoas"
						disabled="#{registrarDenunciaBean.denuncia.codigo eq null}" >
					</p:commandButton>	
					
					<p:commandButton icon="pi pi-trash" title="Excluir Denúncia"
		    			disabled="#{registrarDenunciaBean.denuncia.codigo eq null}"
		    			oncomplete="PF('confirmacaoExclusaoWidgetVar').show()"		            	
		            	update="listaDataTable frmDenuncia:toolbar frmDenuncia:growl"
		            	process="@this">
						<f:setPropertyActionListener target="#{registrarDenunciaBean.denuncia}" 
							value="#{denuncia}" />
					</p:commandButton>		    		
		    		
					<p:commandButton id="show" icon="pi pi-file-o" title="Gerar Atestado"
						disabled="#{not registrarDenunciaBean.atestadoSelecionado}"
						action="#{registrarDenunciaBean.showPDF}"
						process="show" immediate="true" ajax="false"
						update="frmPesquisa:addGrowl">
					</p:commandButton>
					
					<p:commandButton id="showNotificacao" icon="pi pi-file-pdf" title="Gerar Notificação"
						disabled="#{not registrarDenunciaBean.atestadoSelecionado}"
						action="#{registrarDenunciaBean.showPDFNotificacao}"
						process="showNotificacao" immediate="true" ajax="false"
						update="frmPesquisa:addGrowl">
					</p:commandButton>
					
					<p:commandButton id="showDenuncia" icon="pi pi-print" title="Gerar Denúncia"
						disabled="#{not registrarDenunciaBean.atestadoSelecionado}"
						action="#{registrarDenunciaBean.showPDFDenuncia}"
						process="showDenuncia" immediate="true" ajax="false"
						update="frmPesquisa:addGrowl">
					</p:commandButton>
					
		    	</p:column>
    		
		   	</p:dataTable>
	    	
	    	<p:confirmDialog id="confirmacaoExclusaoDialog"
				widgetVar="confirmacaoExclusaoWidgetVar"
				message="Confirma a exclusão?"
				header="Exclusão de ação" severity="alert">
				
				<p:button icon="pi pi-thumbs-down" value="Não"
					onclick="PF('confirmacaoExclusaoWidgetVar').hide(); return false;" />
					
				<p:commandButton icon="pi pi-thumbs-up" value="Sim" 
				    update="frmDenuncia:listaDataTable frmDenuncia:toolbar frmDenuncia:growl"
					onclick="PF('confirmacaoExclusaoWidgetVar').hide();"
					action="#{registrarDenunciaBean.excluir}" 
					process="@this"/>
					
			</p:confirmDialog>
	    	
	    	
    	</h:form>
    </ui:define>
</ui:composition>