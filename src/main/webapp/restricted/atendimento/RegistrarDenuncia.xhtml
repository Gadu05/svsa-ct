<ui:composition template="/WEB-INF/template/LayoutPadrao.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
 	xmlns:h="http://xmlns.jcp.org/jsf/html"
 	xmlns:f="http://xmlns.jcp.org/jsf/core"
 	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:o="http://omnifaces.org/ui">

    <ui:define name="titulo">Formulário de Denúncia</ui:define>
    
    <ui:define name="corpo">    	
    
    	<h2>Registrar Denúncia</h2>
    	
    	<h:form id="frmDenuncia"
    	target="_blank">
    	
    		<p:growl id="growl" showDetail="false"> 
    			<p:autoUpdate />
    		</p:growl>
  
    		
    		<p:toolbar id="toolbar">
				<f:facet name="left">
	    	
	    		<p:commandButton icon="pi pi-user-plus" title="Nova" value="Registrar Denúncia" 		            	
	            	actionListener="#{registrarDenunciaBean.limpar}" 	            
	            	oncomplete="PF('denDialogWidgetVar').show()"
	            	update="denDialog toolbar" 
	            	process="@this">
	            	<p:resetInput target="denDialog" />	
            	</p:commandButton>
            	
	       		</f:facet>
			</p:toolbar>
	    	
	    	 <!--  Lista de denuncias nao terminadas -->
			<p:dataTable id="listaDataTable"  value="#{registrarDenunciaBean.denuncias}" var="denuncia"
				allowUnsorting="true" sortMode="single"
	    		style="margin-top: 20px" emptyMessage="Nenhuma denuncia encontrada." rows="10" 
	    		paginator="true" paginatorAlwaysVisible="true" paginatorPosition="bottom" 
	    		rowsPerPageTemplate="10,15,20"
	    		selectionMode="single" selection="#{registrarDenunciaBean.denuncia}" rowKey="#{denuncia.codigo}">
	    		
	    		<p:ajax event="rowSelect" update="listaDataTable" />			
				<p:ajax event="rowUnselect" update="listaDataTable" />

		    		
		    	<p:column headerText="Data" style="width: 15px; text-align: center"
		    		sortBy="#{denuncia.dataEmissao}">		    		
		    		<h:outputText value="#{denuncia.dataEmissao}">
	    				<f:convertDateTime pattern="dd/MM/yyyy" />
	    			</h:outputText>	    		
	    		</p:column>	    				    		


				<p:column headerText="Código" style="width: 10px; text-align: center">	    			
	    			<h:outputText value="#{denuncia.codigo}"/>
	    		</p:column>
	    		
    			<p:column headerText="Nome Criança" style="width: 80px; text-align: center">	    			
	    			<h:outputText value="#{denuncia.pessoa.nomeCrianca}" />
	    		</p:column>
	    		
	    		<p:column headerText="Nome Mãe" style="width: 80px; text-align: center">	    			
	    			<h:outputText value="#{denuncia.pessoa.nomeMae}" />
	    		</p:column>
				
				<p:column headerText="Relato" style="width: 80px; text-align: center">	    			
	    			<h:outputText value="#{denuncia.relato}" />
	    		</p:column> 
	    		
	    		<p:column headerText="RD Status" style="width: 30px; text-align: center">		
	    			<h:outputText value="#{denuncia.statusRD}" />
	    		</p:column>
	    		
	    		<p:column headerText="RD Vinculado" style="width: 15px; text-align: center">		
	    			<h:outputText value="#{denuncia.prontuario.familia.pessoaReferencia.codigo}" />
	    		</p:column>  
	    		
	    		<p:column headerText="Operações" style="width: 65px; text-align: center" >		    		
										
		    		<p:commandButton icon="pi pi-pencil" title="Editar Denúncia"
		    			disabled="#{registrarDenunciaBean.denuncia.codigo eq null}"
		    			oncomplete="PF('denDialogWidgetVar').show();"
		    			update="frmDenuncia:addGrid frmDenuncia:toolbar frmDenuncia:growl listaDataTable" 
		            	process="@this">
						<f:setPropertyActionListener target="#{registrarDenunciaBean.denuncia}" 
							value="#{denuncia}" />
					</p:commandButton>									    		

				<p:commandButton icon="pi pi-plus" title="Adicionar Pessoas a Denuncia"
						disabled="#{registrarDenunciaBean.denuncia.codigo eq null}"
						oncomplete="PF('cadDenunciaDialogWidgetVar').show();"
						update="frmDenuncia:addGrid frmDenuncia:toolbar frmDenuncia:growl listaDataTable" 
		            	process="@this">
				</p:commandButton>
				
		    		<p:commandButton icon="pi pi-trash" title="Excluir Denúncia"
		    			disabled="#{registrarDenunciaBean.denuncia.codigo eq null}"
		    			oncomplete="PF('confirmacaoExclusaoWidgetVar').show()"		            	
		            	update="listaDataTable frmDenuncia:toolbar frmDenuncia:growl"
		            	process="@this">
						<f:setPropertyActionListener target="#{registrarDenunciaBean.denuncia}" 
							value="#{denuncia}" />
					</p:commandButton>
					
					<p:commandButton icon="pi pi-user-plus" title="Vincular Denúncia" 	
							disabled="#{registrarDenunciaBean.denuncia.codigo eq null}"            	
	            			actionListener="#{registrarDenunciaBean.limpar}" 	            
	            			oncomplete="PF('vinDialogWidgetVar').show()"
	            			update="listaDataTable frmDenuncia:growl frmDenuncia:vinDialog frmDenuncia:toolbar" 
	            			process="@this">
	            		
	            		<f:setPropertyActionListener target="#{registrarDenunciaBean.denuncia}" 
							value="#{denuncia}" />
            		</p:commandButton>
		    		
		    		
					<p:commandButton id="show" icon="pi pi-file-o" title="Gerar Atestado"
						disabled="#{not registrarDenunciaBean.atestadoSelecionado}"
						action="#{registrarDenunciaBean.showPDF}"
						process="show" immediate="true" ajax="false"
						update="frmPesquisa:addGrowl">
					</p:commandButton>
					
					<p:commandButton id="showNotificacao" icon="pi pi-file-pdf" title="Gerar Notificação"
						disabled="#{not registrarDenunciaBean.atestadoSelecionado}"
						action="#{registrarDenunciaBean.showPDFNotificacao}"
						process="showNotificacao" immediate="true" ajax="false"
						update="frmPesquisa:addGrowl">
					</p:commandButton>
					
					<p:commandButton id="showDenuncia" icon="pi pi-print" title="Gerar Denúncia"
						disabled="#{not registrarDenunciaBean.atestadoSelecionado}"
						action="#{registrarDenunciaBean.showPDFDenuncia}"
						process="showDenuncia" immediate="true" ajax="false"
						update="frmPesquisa:addGrowl">
					</p:commandButton>
					
		    	</p:column>
    		
		   	</p:dataTable>
		   	
	   		<p:dialog id="denDialog" header="Denuncia" widgetVar="denDialogWidgetVar"
	   		modal="true" resizable="true" closeOnEscape="true" 
				showEffect="explode" hideEffect="explode" 
				width="100%" position="center top" maximizable="true"
				height="70%" fitViewport="true" responsive="true">	
				
				
		    	<p:panelGrid id="addGrid" columns="2" styleClass="showcase-text-align-center"
		    		columnClasses="rotulo, campo">
		    		
		    		<p:outputLabel value="Data " for="data" size="30"/>
		    		<p:calendar id="data" 
		    			value="#{registrarDenunciaBean.denuncia.dataEmissao}" 
			    		required="true"
			    		showOn="button" 
				    	validatorMessage="A data é obrigatória."
				    	pattern="dd/MM/yyyy"
						mask="99/99/9999"/>
		    		
	    			<p:outputLabel value="Origem Denúncia" for="orig" />
		    		<p:selectOneMenu id="orig" 
		    			required="true" 
		    			value="#{registrarDenunciaBean.denuncia.origemDenuncia}"
		    		    validatorMessage="O tipo de origem é obrigatório.">		    		    
		    			<f:selectItem itemLabel="Selecione a origem" />
		    			<f:selectItems value="#{registrarDenunciaBean.origens}" var="org" 
							itemLabel="#{org}" itemValue="#{org}"/>
		    		</p:selectOneMenu>    			
						
					<p:outputLabel value="Agente Violador" for="agente" />
		    		<p:selectOneMenu id="agente" 
		    			required="true" 
		    			value="#{registrarDenunciaBean.denuncia.agenteViolador}"
		    		    validatorMessage="O tipo de agente é obrigatório.">		    		    
		    			<f:selectItem itemLabel="Selecione o agente" />
		    			<f:selectItems value="#{registrarDenunciaBean.agentes}" var="agt" 
							itemLabel="#{agt}" itemValue="#{agt}"/>
		    		</p:selectOneMenu>  	
					
					<p:outputLabel value="Status" for="status" />
					<h:outputText id="status" value="#{registrarDenunciaBean.denuncia.statusRD}" />
					
					<p:outputLabel value="Direito Violado" for="viol" />
		    		<p:selectOneMenu id="viol" 
		    			required="true" 
		    			value="#{registrarDenunciaBean.denuncia.direitoViolado}"
		    		    validatorMessage="O tipo de direito violado é obrigatório.">		    		    
		    			<f:selectItem itemLabel="Selecione o direito violado" />
		    			<f:selectItems value="#{registrarDenunciaBean.direitos}" var="vio" 
							itemLabel="#{vio}" itemValue="#{vio}"/>
		    		</p:selectOneMenu>  
					
					
					<p:outputLabel value="Relato" for="relato"/>
		    		<h:panelGroup>
		    			<p:inputTextarea id="relato" size="150" rows="4" cols="80" style="height: 100px; overflow:auto;"
			    			maxlength="250" 
		    				value="#{registrarDenunciaBean.denuncia.relato}"
			    			counter="display"
							counterTemplate="{0} restantes"/>
				    	<h:outputText id="display" />
					    <p:watermark for="relato" value="Descreva aqui o relato." />		
		        	</h:panelGroup>	
		    				
		    		<h:outputLabel />		    			
	           		<p:commandButton icon="pi pi-save" id="salvar" value="Salvar" 
						title="Salva a descrição da denúncia"
						actionListener="#{registrarDenunciaBean.salvar}"
						oncomplete="if (!args.validationFailed) PF('denDialogWidgetVar').hide()" 			
						update="addGrid frmDenuncia:listaDataTable frmDenuncia:growl"								
						process="addGrid">
					</p:commandButton>

		    	</p:panelGrid>
	    	</p:dialog>	
	    	
	    	<p:dialog id="cadDenunciaDialog" header="Cadastro Denuncia" widgetVar="cadDenunciaDialogWidgetVar"
	   		modal="true" resizable="true" closeOnEscape="true" 
				showEffect="explode" hideEffect="explode" 
				width="100%" position="center top" maximizable="true"
				height="70%" fitViewport="true" responsive="true">	
				
				<p:toolbar id="cadDenunciatoolbar">
				<f:facet name="left">

						<p:commandButton icon="pi pi-user-plus" title="Adicionar Genitora"
							value="Adicionar Genitora" oncomplete="PF('genitoraWidgetVar').show()"
							process="@this">
						</p:commandButton>

						<p:commandButton icon="pi pi-user-plus" title="Adicionar Genitor"
							value="Adicionar Genitor">
						</p:commandButton>

						<p:commandButton icon="pi pi-user-plus" title="Adicionar Terceiro"
							value="Adicionar Terceiro">
						</p:commandButton>

						<p:commandButton icon="pi pi-user-plus" title="Adicionar Criança"
							value="Adicionar Crianca/Adolescente">
						</p:commandButton>

					</f:facet>
				</p:toolbar>
				
				<p:panelGrid id="cadDenunciaGrid" columns="2" styleClass="showcase-text-align-center"
		    		columnClasses="rotulo, campo">
		    		
		    		<p:outputLabel value="Nome da Genitora: " for="nomeMae3" />
		    		<h:outputText id="nomeMae3" value="#{registrarDenunciaBean.denuncia.pessoa.nomeMae}" />
		    		
		    		<p:outputLabel value="Nome do Genitor: " for="nomePai" />
		    		<h:outputText id="nomePai" value="#{registrarDenunciaBean.denuncia.pessoa.nomePai}" />
		    		
		    		<p:outputLabel value="Nome do Terceiro: " for="nomeTerceiro" />
		    		<h:outputText id="nomeTerceiro" value="#{registrarDenunciaBean.denuncia.pessoa.nomeTerceiro}" />
		    		
		    		<p:outputLabel value="Nome da Crianca: " for="nomeCrianca" />
		    		<h:outputText id="nomeCrianca" value="#{registrarDenunciaBean.denuncia.pessoa.nomeCrianca}" />
		    		
		    	</p:panelGrid>
		    	
		    </p:dialog>
		    
		    <p:dialog id="genitoraDialog" header="Dados da Genitora" widgetVar="genitoraWidgetVar"
	   		modal="true" resizable="true" closeOnEscape="true" 
				showEffect="explode" hideEffect="explode" 
				width="100%" position="center top" maximizable="true"
				height="70%" fitViewport="true" responsive="true">	
				
				
				<p:panelGrid id="genitoraGrid" columns="2" styleClass="showcase-text-align-center"
		    		columnClasses="rotulo, campo">
		    		
		    		<p:outputLabel value="Nome da Genitora: " for="nomedaMae" />
		    		<p:autoComplete id="nomedaMae" value="#{registrarDenunciaBean.denuncia.pessoa.nomeMae}"
		    			size="60" maxlength="80"
		    			required="false"
		    			effect="blind">
		    		</p:autoComplete>
		    		
		    		<p:outputLabel value="RG da Mãe: " for="rgMae" />
		    		<p:autoComplete id="rgMae" value="#{registrarDenunciaBean.denuncia.pessoa.rg}"
		    			size="30" maxlength="80"
		    			required="false"
		    			effect="blind">
		    		</p:autoComplete>
		    		
		    		<p:outputLabel value="Endereço da Mãe: " for="enderecoMae" />
		    		<p:autoComplete id="enderecoMae" value="#{registrarDenunciaBean.denuncia.pessoa.endereco}"
		    			size="60" maxlength="80"
		    			required="false"
		    			effect="blind">
		    		</p:autoComplete>
		    		
		    		<p:outputLabel value="Telefone da Mãe: " for="telefoneMae" />
		    		<p:autoComplete id="telefoneMae" value="#{registrarDenunciaBean.denuncia.pessoa.telefone}"
		    			size="30" maxlength="80"
		    			required="false"
		    			effect="blind">
		    		</p:autoComplete>
		    		
		    		<h:outputLabel />		    			
	           		<p:commandButton icon="pi pi-save" id="salvarGenitora" value="Salvar Genitora" 
						title="Salva os dados da Genitora"
						actionListener="#{registrarDenunciaBean.salvar}"
						oncomplete="if (!args.validationFailed) PF('genitoraGrid').hide()" 			
						update="genitoraGrid frmDenuncia:listaDataTable frmDenuncia:growl"								
						process="genitoraGrid">
					</p:commandButton>
					
		    	</p:panelGrid>
			</p:dialog>
	    	
	    	<p:confirmDialog id="confirmacaoExclusaoDialog"
				widgetVar="confirmacaoExclusaoWidgetVar"
				message="Confirma a exclusão?"
				header="Exclusão de ação" severity="alert">
				
				<p:button icon="pi pi-thumbs-down" value="Não"
					onclick="PF('confirmacaoExclusaoWidgetVar').hide(); return false;" />
					
				<p:commandButton icon="pi pi-thumbs-up" value="Sim" 
				    update="frmDenuncia:listaDataTable frmDenuncia:toolbar frmDenuncia:growl"
					onclick="PF('confirmacaoExclusaoWidgetVar').hide();"
					action="#{registrarDenunciaBean.excluir}" 
					process="@this"/>
					
			</p:confirmDialog>
	    	
	    	<p:dialog id="vinDialog" header="Vincular denúncia" widgetVar="vinDialogWidgetVar"				
	   			modal="true" resizable="true" closeOnEscape="true" 
				showEffect="explode" hideEffect="explode" 
				style="max-height:600px;overflow:scroll" position="center top">
				
		    	<p:panelGrid id="vinGrid" columns="2" 
		    		columnClasses="rotulo, campo">	
						
		    		<p:outputLabel value="Nome" for="nomePessoa"/>
		    		<p:autoComplete id="nomePessoa" value="#{registrarDenunciaBean.nome}" 
		    			size="60" maxlength="80" 
		    			required="true" 
        				effect="blind"  
		    			completeMethod="#{registrarDenunciaBean.buscarNomes}">
		    			
		    			<p:ajax partialSubmit="nomePessoa" 
		    				event="itemSelect" listener="#{registrarDenunciaBean.buscarPessoa}" update= "codigoPessoa nomeMae2"/>  
		    		</p:autoComplete>
		    		
		    		<p:outputLabel value="Codigo da Pessoa" for="codigoPessoa"/>
					<h:outputText id="codigoPessoa" value="#{registrarDenunciaBean.denuncia.prontuario.familia.pessoaReferencia.codigo}" />
					
					<p:outputLabel value="Nome Mãe" for="nomeMae2"/>
					<h:outputText id="nomeMae2" value="#{registrarDenunciaBean.denuncia.prontuario.familia.pessoaReferencia.nomeMae}" />
		    		
		    		<p:commandButton icon="pi pi-save" id="vincular" value="Vincular RD" 
						title="Vincular a RD"
						actionListener="#{registrarDenunciaBean.salvar}"
						oncomplete="if (!args.validationFailed) PF('vinDialogWidgetVar').hide()" 			
						update="vinGrid frmDenuncia:listaDataTable frmDenuncia:growl"								
						process="vinGrid">
					</p:commandButton>

		    	</p:panelGrid>
	    	</p:dialog>	
	    	
    	</h:form>
    </ui:define>
</ui:composition>