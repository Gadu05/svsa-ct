<ui:composition template="/WEB-INF/template/LayoutPadrao.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
 	xmlns:h="http://xmlns.jcp.org/jsf/html"
 	xmlns:f="http://xmlns.jcp.org/jsf/core"
 	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:o="http://omnifaces.org/ui">

    <ui:define name="titulo">Capa RD</ui:define>
    
    <ui:define name="corpo">
    	<h2>Capa RD</h2>
    	
    	<h:form id="frmPesquisa" enctype="multipart/form-data" target="_blank">
    	
    		<p:messages id="messages" showDetail="false" closable="true">
        		<p:autoUpdate />
    		</p:messages>
    		
	    	<p:toolbar id="toolbar" style="margin-top: 20px">
	    		<p:toolbarGroup>
	    			<p:commandButton icon="pi pi-plus" value="Novo" id="botaoNovo"
						action="/restricted/agenda/CadastroCapaProntuario.xhtml" />  			
	    		</p:toolbarGroup>    			
	    	</p:toolbar>       	
	    	
	    	<p:dataTable id="prontuariosTable" var="prontuario" value="#{pesquisaProntuarioBean.lazyProntuarios}" 
		    		style="margin-top: 20px" emptyMessage="Nenhum RD encontrado." paginator="true" rows="10"
		    		paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
	    			currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros"
	    			rowsPerPageTemplate="10,15,20" lazy="true"
		    		rowStyleClass="#{prontuario.status eq 'INATIVO' ? 'inativo' : null}">	    		
	    						
				<p:column headerText="Última Atualização" style="width: 10px; text-align: center">
	    			<h:outputText value="#{prontuario.dataModificacao}">
	    				<f:convertDateTime pattern="dd/MM/yyyy" />
	    			</h:outputText>
	    		</p:column> 
				
	    		<p:column headerText="RD Código" style="width: 9px; text-align: center"
	    			filterBy="#{prontuario.codigo}">
	    			<h:outputText value="#{prontuario.codigo}" />
	    		</p:column>    		
	    			
	    		<p:column headerText="RD Físico" style="width: 10px; text-align: center">
	    			<h:outputText value="#{prontuario.prontuario}" />
	    		</p:column>	    		
	    		
	    		<p:column  headerText="Pessoa Código" style="width: 10px; text-align: center">
					<h:outputText value="#{prontuario.familia.pessoaReferencia.codigo}" />
				</p:column>
				
	    		<p:column headerText="Pessoa Responsável" style="width: 60px; text-align: left"
	    			filterBy="#{prontuario.familia.pessoaReferencia.nome}">
	    			<h:outputText value="#{prontuario.familia.pessoaReferencia.nome}" />
	    		</p:column>
	    		
	    		<p:column  headerText="NIS" style="width: 15px; text-align: center">
					<h:outputText value="#{prontuario.familia.pessoaReferencia.nis}" />
				</p:column>
	    		
	    		<p:column headerText="Data de Nasc." style="width: 15px; text-align: center">
	    			<h:outputText value="#{prontuario.familia.pessoaReferencia.dataNascimento}">
	    				<f:convertDateTime pattern="dd/MM/yyyy" />
	    			</h:outputText>
	    		</p:column>
	    		
	    		<p:column headerText="Operações" style="width: 80px; text-align: left">
	    		
	    			<p:button outcome="CadastroCapaProntuario" icon="pi pi-pencil" title="Editar RD">
		    			<f:param name="prontuario" value="#{prontuario.codigo}"/>
		    		</p:button>		    		
		    		
					<p:commandButton icon="pi pi-thumbs-up" title="Ativar RD"
						rendered="#{prontuario.status eq 'INATIVO'}"
						onclick="PF('confirmacaoAtivacao').show();"
		        		process="@this">		        		
		        		<f:setPropertyActionListener target="#{pesquisaProntuarioBean.prontuarioSelecionado}" 
							value="#{prontuario}" />
					</p:commandButton>					
					<p:commandButton icon="pi pi-thumbs-down" title="Inativar RD"
						rendered="#{prontuario.status eq 'ATIVO'}"					
						onclick="PF('confirmacaoInativacao').show();"
		        		process="@this">		        		
		        		<f:setPropertyActionListener target="#{pesquisaProntuarioBean.prontuarioSelecionado}" 
							value="#{prontuario}" />
					</p:commandButton>
					
					<p:commandButton icon="pi pi-trash" title="Excluir RD"
		    			rendered="#{pesquisaProntuarioBean.coordenador}"
		    			onclick="PF('confirmacaoExclusao').show();"
						process="@this">
						<f:setPropertyActionListener target="#{pesquisaProntuarioBean.prontuarioSelecionado}" 
							value="#{prontuario}" />
					</p:commandButton>	    			
	    			  					
					<p:commandButton icon="pi pi-user" title="Informações do RD" 
						update="frmPesquisa:infoGrid" 		    		
  						onclick="PF('infoDialog').show()"  						
  						process="@this"> 
  						<f:setPropertyActionListener target="#{pesquisaProntuarioBean.prontuarioSelecionado}" 
							value="#{prontuario}" />
	            	</p:commandButton>		
		    	</p:column>
		    	
		   	</p:dataTable>
		   	
		   	<p:dialog header="Último Atendimento" widgetVar="itemDialog" modal="true" showEffect="fade" hideEffect="fade" 
		   		resizable="false" closeOnEscape="true" position="center top">
	        	<p:outputPanel id="detAtendimento" style="text-align:lefty;">
		            <p:panelGrid  columns="2" 
		            	columnClasses="label,value">
		            	
		            </p:panelGrid>
	       		</p:outputPanel>
	    	</p:dialog>
		   	
		   	<p:confirmDialog id="confirmacaoExclusaoDialog" 
		   		widgetVar="confirmacaoExclusao"
	        	message="O PRONTUÁRIO e todos os seus MEMBROS serão excluídos. Tem certeza que deseja continuar?"  
	            header="Exclusão de prontuário" severity="alert">
	        	<p:button icon="pi pi-thumbs-down" value="Não" 
	        		onclick="PF('confirmacaoExclusao').hide(); return false;" />
	        	<p:commandButton icon="pi pi-thumbs-up" value="Sim" 
	        		process="@this"
	        		update=":frmPesquisa:prontuariosTable"
	        		onclick="PF('confirmacaoExclusao').hide();"
	        		action="#{pesquisaProntuarioBean.excluir}" />
	    	</p:confirmDialog>
	    	
	    	<p:confirmDialog id="confirmacaoAtivacaoDialog" 
		   		widgetVar="confirmacaoAtivacao"
	        	message="O PRONTUÁRIO e todos os seus MEMBROS serão reativados. Tem certeza que deseja continuar?"  
	            header="Ativação de prontuário" severity="alert">
	        	<p:button icon="pi pi-thumbs-down" value="Não" 
	        		onclick="PF('confirmacaoAtivacao').hide(); return false;" />
	        	<p:commandButton icon="pi pi-thumbs-up" value="Sim" 
	        		process="@this"
	        		update=":frmPesquisa:prontuariosTable"
	        		onclick="PF('confirmacaoAtivacao').hide();"
	        		action="#{pesquisaProntuarioBean.ativar}" />
	    	</p:confirmDialog> 
	    	
	    	<p:confirmDialog id="confirmacaoInativacaoDialog" 
		   		widgetVar="confirmacaoInativacao"
	        	message="O PRONTUÁRIO e todos os seus MEMBROS serão inativados. Tem certeza que deseja continuar?"  
	            header="Inativação de prontuário" severity="alert">
	        	<p:button icon="pi pi-thumbs-down" value="Não" 
	        		onclick="PF('confirmacaoInativacao').hide(); return false;" />
	        	<p:commandButton icon="pi pi-thumbs-down" value="Sim" 
	        		process="@this"
	        		update=":frmPesquisa:prontuariosTable"
	        		onclick="PF('confirmacaoInativacao').hide();"
	        		action="#{pesquisaProntuarioBean.inativar}"/>
	    	</p:confirmDialog>  
	    	
	    	
			<p:dialog header="Informações sobre o RD" widgetVar="infoDialog" modal="true" showEffect="fade" hideEffect="fade" 
		   		resizable="false" closeOnEscape="true" position="center top">
	        	<p:outputPanel id="criador" style="text-align:left;">
		            <p:panelGrid id="infoGrid" columns="2" columnClasses="label,value">
		            	
						<p:outputLabel value="Data da Entrada: "/>
		                <h:outputText value="#{pesquisaProntuarioBean.prontuarioSelecionado.dataEntrada}" style="font-weight:bold">
	    					<f:convertDateTime pattern="dd/MM/yyyy" />
	    				</h:outputText>	
		   				
		   				<p:outputLabel value=""/><p:outputLabel value=""/>
		   				
		            	<p:outputLabel value="Conselheiro que criou o RD "/>
		   				<h:outputText value="#{pesquisaProntuarioBean.prontuarioSelecionado.criador}" style="font-weight:bold"/>		   				
		   				<p:outputLabel value="Data criação: "/>
		   				<h:outputText value="#{pesquisaProntuarioBean.prontuarioSelecionado.dataCriacao}" style="font-weight:bold">
		   					<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
		   				</h:outputText>		   				
		   				
		   				<p:outputLabel value=""/><p:outputLabel value=""/>
		   				
		   				<p:outputLabel value="NIS da pessoa responsável "/>
		   				<h:outputText value="#{pesquisaProntuarioBean.prontuarioSelecionado.familia.pessoaReferencia.nis}" style="font-weight:bold"/>		   				
		   				<p:outputLabel value="Data da criação/atualização do CadÚnico: "/>
		                <h:outputText value="#{pesquisaProntuarioBean.prontuarioSelecionado.familia.pessoaReferencia.dataNis}" style="font-weight:bold">
	    					<f:convertDateTime pattern="dd/MM/yyyy" />
	    				</h:outputText>	
		   				
		   				<p:outputLabel value=""/><p:outputLabel value=""/>
		   				
		   				<p:outputLabel value="Último atendimento da Pessoa Responsável "/>
		   				<h:outputText value="#{pesquisaProntuarioBean.ultimoAtendimento.pessoa.nome}" style="font-weight:bold"/>		   				
		   				<p:outputLabel value="Data do atendimento: "/>
		                <h:outputText value="#{pesquisaProntuarioBean.ultimoAtendimento.dataAtendimento}" style="font-weight:bold">
	    					<f:convertDateTime pattern="dd/MM/yyyy" />
	    				</h:outputText>	
	    					                
		            </p:panelGrid>
	       		</p:outputPanel>
	    	</p:dialog>	 
			
    	</h:form>
    </ui:define>
</ui:composition>